<!DOCTYPE html>
<html>
<head>
  <title>Ultimate Bingo Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #334155;
      overflow-x: hidden;
    }
    
    .starfield {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: -1;
    }
    
    .star {
      position: absolute;
      background: rgba(148, 163, 184, 0.3);
      border-radius: 50%;
      animation: twinkle 4s infinite ease-in-out;
    }
    
    @keyframes twinkle {
      0%, 100% { opacity: 0.1; transform: scale(0.8); }
      50% { opacity: 0.4; transform: scale(1.1); }
    }
    
    h1 {
      font-size: clamp(48px, 8vw, 72px);
      font-weight: 700;
      letter-spacing: 8px;
      text-shadow: 0 2px 8px rgba(51, 65, 85, 0.1);
      margin-bottom: 30px;
      background: linear-gradient(135deg, #334155, #64748b, #94a3b8);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: subtleGlow 4s ease-in-out infinite alternate;
    }
    
    .sequence-display {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(20px);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.5);
      max-width: 800px;
      width: 90vw;
      text-align: center;
    }
    
    .sequence-title {
      font-size: 18px;
      font-weight: 600;
      color: #475569;
      margin-bottom: 15px;
    }
    
    .sequence-numbers {
      font-size: 16px;
      color: #64748b;
      line-height: 1.6;
      min-height: 24px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
    }
    
    .sequence-number {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: white;
      padding: 4px 10px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(99, 102, 241, 0.2);
      animation: numberAppear 0.3s ease-out;
    }
    
    @keyframes numberAppear {
      0% { transform: scale(0.8); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    @keyframes subtleGlow {
      from { filter: drop-shadow(0 2px 4px rgba(51, 65, 85, 0.1)); }
      to { filter: drop-shadow(0 4px 8px rgba(100, 116, 139, 0.15)); }
    }
    
    #bingo-letters {
      display: flex;
      gap: 20px;
      margin-bottom: 40px;
      perspective: 1000px;
    }
    
    #bingo-letters span {
      width: 60px; height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      font-weight: 600;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(148, 163, 184, 0.2);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.04);
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      transform-style: preserve-3d;
      color: #475569;
    }
    
    #bingo-letters span.striked {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      transform: rotateY(180deg) scale(1.05);
      box-shadow: 0 8px 24px rgba(99, 102, 241, 0.2);
      text-decoration: line-through;
      animation: letterStrike 0.6s ease-out;
      color: white;
    }
    
    @keyframes letterStrike {
      0% { transform: rotateY(0deg) scale(1); }
      50% { transform: rotateY(90deg) scale(1.15); }
      100% { transform: rotateY(180deg) scale(1.05); }
    }
    
    .game-container {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.5);
      max-width: 1300px;
      width: 95vw;
      margin: 0 auto;
    }
    
    table {
      width: 100%;
      max-width: 400px;
      border-collapse: separate;
      border-spacing: 8px;
      margin: 0 auto 30px auto;
    }
    
    td {
      width: 80px;
      height: 80px;
      border-radius: 12px;
      font-size: 28px;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
      position: relative;
      transition: all 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      background: linear-gradient(135deg, #ffffff, #f8fafc);
      color: #334155;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(226, 232, 240, 0.8);
    }
    
    td:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.9);
      border-color: rgba(100, 116, 139, 0.3);
    }
    
    td.setup-cell {
      background: linear-gradient(135deg, rgba(248, 250, 252, 0.8), rgba(241, 245, 249, 0.6));
      border: 2px dashed rgba(148, 163, 184, 0.4);
      color: rgba(100, 116, 139, 0.7);
    }
    
    td.setup-cell:hover {
      background: linear-gradient(135deg, rgba(241, 245, 249, 0.9), rgba(226, 232, 240, 0.7));
      border: 2px solid rgba(100, 116, 139, 0.5);
    }
    
    td.setup-cell.filled {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: #fff;
      border: 1px solid rgba(99, 102, 241, 0.3);
      animation: fillPop 0.3s ease-out;
    }
    
    @keyframes fillPop {
      0% { transform: scale(0.9); opacity: 0; }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    td.striked {
      background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
      color: #fff !important;
      transform: scale(0.98);
      animation: strikeEffect 0.4s ease-out;
      box-shadow: 0 4px 16px rgba(99, 102, 241, 0.25);
      border-color: rgba(99, 102, 241, 0.3);
    }
    
    @keyframes strikeEffect {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); background: linear-gradient(135deg, #8b5cf6, #6366f1); }
      100% { transform: scale(0.98); }
    }
    
    .btn {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 14px 28px;
      font-size: 16px;
      font-weight: 600;
      margin: 8px;
      cursor: pointer;
      transition: all 0.25s ease;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
      position: relative;
      overflow: hidden;
    }
    
    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(99, 102, 241, 0.25);
      background: linear-gradient(135deg, #5b5bd6, #7c3aed);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    #current-number {
      text-align: center;
      font-size: 22px;
      margin: 20px 0;
      padding: 16px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 12px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(226, 232, 240, 0.5);
      color: #475569;
    }
    
    .setup-panel {
      text-align: center;
    }
    
    .setup-panel h3 {
      margin-bottom: 25px;
      font-size: 22px;
      text-shadow: 0 1px 3px rgba(51, 65, 85, 0.1);
      font-weight: 600;
      color: #475569;
    }
    
    /* Debug info */
    .debug-info {
      position: fixed;
      top: 10px; left: 10px;
      background: rgba(255, 255, 255, 0.9);
      color: #334155;
      padding: 12px;
      border-radius: 8px;
      font-size: 11px;
      font-family: 'JetBrains Mono', 'Consolas', monospace;
      z-index: 1001;
      max-width: 300px;
      border: 1px solid rgba(226, 232, 240, 0.8);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    /* Confetti Animation */
    .confetti-container {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: 1000;
      display: none;
    }
    
    .confetti {
      position: absolute;
      width: 8px; height: 8px;
      background: #6366f1;
      animation: confettiFall 3s linear forwards;
      border-radius: 2px;
    }
    
    @keyframes confettiFall {
      0% {
        transform: translateY(-100vh) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
    
    /* Fireworks Animation */
    .fireworks-container {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: 999;
      display: none;
    }
    
    .firework {
      position: absolute;
      width: 3px; height: 3px;
      border-radius: 50%;
      animation: explode 1.2s ease-out forwards;
    }
    
    @keyframes explode {
      0% {
        transform: translate(0, 0) scale(0);
        opacity: 1;
      }
      100% {
        transform: translate(var(--dx), var(--dy)) scale(1);
        opacity: 0;
      }
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .game-container {
        max-width: 95vw;
        width: 95vw;
        padding: 25px;
      }
      
      td { width: 60px; height: 60px; font-size: 22px; }
      h1 { font-size: 48px; letter-spacing: 6px; }
      #bingo-letters span { width: 50px; height: 50px; font-size: 28px; }
      
      table {
        max-width: 320px;
      }
      
      .vs-computer-interface {
        grid-template-columns: 1fr;
        gap: 25px;
        text-align: center;
        justify-items: center;
        padding: 0 10px;
        place-items: center;
      }
      
      .called-number-display {
        order: -1;
        min-width: auto;
        margin-bottom: 20px;
        width: 100%;
        max-width: 300px;
      }
      
      .player-section {
        width: 100%;
        max-width: 350px;
        margin: 0 auto;
        min-width: auto;
      }
      
      .player-bingo-letters span {
        width: 35px;
        height: 35px;
        font-size: 18px;
      }
      
      .called-number {
        font-size: 42px !important;
      }
    }

    @media (max-width: 480px) {
      .game-container {
        padding: 20px;
        width: 98vw;
      }
      
      table {
        max-width: 280px;
      }
      
      .vs-computer-interface {
        gap: 20px;
        padding: 0 5px;
      }
      
      .player-section {
        min-width: auto;
        max-width: 300px;
      }
      
      td { width: 50px; height: 50px; font-size: 18px; }
      
      .player-bingo-letters {
        gap: 8px;
      }
      
      .player-bingo-letters span {
        width: 30px;
        height: 30px;
        font-size: 16px;
      }
      
      .called-number-display {
        max-width: 260px;
        padding: 18px;
      }
    }

    /* Instruction Modal */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .modal {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 30px;
      max-width: 500px;
      width: 90vw;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.8);
      text-align: center;
      color: #334155;
    }

    .modal h2 {
      margin-bottom: 20px;
      color: #6366f1;
      font-size: 28px;
      font-weight: 700;
    }

    .modal p {
      margin-bottom: 15px;
      line-height: 1.6;
      font-size: 16px;
    }

    .modal .highlight {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 600;
    }

    /* Win Animation */
    .win-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.9), rgba(139, 92, 246, 0.9));
      backdrop-filter: blur(10px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 3000;
      animation: winFadeIn 0.5s ease-out;
    }

    .win-content {
      text-align: center;
      color: white;
      animation: winBounce 0.8s ease-out;
    }

    .win-title {
      font-size: 72px;
      font-weight: 900;
      margin-bottom: 20px;
      text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      animation: winPulse 2s ease-in-out infinite;
    }

    .win-subtitle {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 30px;
      opacity: 0.9;
    }

    @keyframes winFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes winBounce {
      0% { transform: translateY(-50px) scale(0.8); opacity: 0; }
      50% { transform: translateY(10px) scale(1.05); }
      100% { transform: translateY(0) scale(1); opacity: 1; }
    }

    @keyframes winPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .win-sequence {
      margin: 30px 0;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      backdrop-filter: blur(10px);
    }
    
    .win-sequence-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 15px;
      color: rgba(255, 255, 255, 0.9);
    }
    
    .win-sequence-numbers {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      max-height: 150px;
      overflow-y: auto;
    }
    
    .win-sequence-numbers .sequence-number {
      background: rgba(255, 255, 255, 0.9);
      color: #6366f1;
      padding: 6px 12px;
      border-radius: 8px;
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    /* VS Computer Mode Styles */
    .game-mode-selector {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 12px;
      border: 1px solid rgba(226, 232, 240, 0.5);
    }

    .mode-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 15px;
    }

    .mode-btn {
      background: linear-gradient(135deg, #64748b, #475569);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(100, 116, 139, 0.15);
    }

    .mode-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(100, 116, 139, 0.25);
    }

    .mode-btn.active {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);
    }

    .vs-computer-interface {
      display: none;
      grid-template-columns: 1fr auto 1fr;
      gap: 40px;
      align-items: start;
      justify-items: center;
      margin: 0 auto 20px auto;
      max-width: 1200px;
      width: 100%;
      place-items: center;
    }

    .player-section {
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-width: 350px;
      width: 100%;
    }

    .player-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      color: #475569;
    }

    .player-title.you {
      color: #6366f1;
    }

    .player-title.computer {
      color: #dc2626;
    }

    .player-bingo-letters {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      justify-content: center;
    }

    .player-bingo-letters span {
      width: 45px; 
      height: 45px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 600;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(148, 163, 184, 0.2);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      transform-style: preserve-3d;
      color: #475569;
    }

    .player-bingo-letters span.striked {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      transform: rotateY(180deg) scale(1.05);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
      text-decoration: line-through;
      animation: letterStrike 0.6s ease-out;
      color: white;
    }

    .computer-bingo-letters span.striked {
      background: linear-gradient(135deg, #dc2626, #b91c1c);
      color: white;
    }

    .computer-grid {
      opacity: 0.8;
      pointer-events: none;
    }

    .computer-grid td.striked {
      background: linear-gradient(135deg, #dc2626, #b91c1c) !important;
    }

    .called-number-display {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-width: 200px;
      padding: 25px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      border: 2px solid rgba(99, 102, 241, 0.3);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(15px);
    }

    .called-number {
      font-size: 56px;
      font-weight: 900;
      color: #6366f1;
      margin-bottom: 12px;
      animation: numberPulse 0.5s ease-out;
      text-shadow: 0 2px 8px rgba(99, 102, 241, 0.2);
    }

    .called-label {
      font-size: 16px;
      color: #64748b;
      font-weight: 600;
      margin-bottom: 15px;
    }

    .turn-indicator {
      font-size: 18px;
      font-weight: 700;
      padding: 12px 20px;
      border-radius: 25px;
      margin-bottom: 20px;
      animation: turnPulse 1.5s ease-in-out infinite;
      text-align: center;
      min-width: 180px;
    }

    .turn-indicator.player-turn {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: white;
    }

    .turn-indicator.computer-turn {
      background: linear-gradient(135deg, #dc2626, #b91c1c);
      color: white;
    }

    @keyframes turnPulse {
      0%, 100% { transform: scale(1); opacity: 0.9; }
      50% { transform: scale(1.05); opacity: 1; }
    }

    .call-button {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 5px;
    }

    .call-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(99, 102, 241, 0.25);
    }

    .call-button:disabled {
      background: #94a3b8;
      cursor: not-allowed;
      transform: none;
    }

    @keyframes numberPulse {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes numberHighlight {
      0% { background: #fbbf24; transform: scale(1); }
      50% { background: #f59e0b; transform: scale(1.1); }
      100% { background: initial; transform: scale(1); }
    }

    .game-controls {
      text-align: center;
      margin: 20px 0;
    }

    .speed-control {
      margin: 10px;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      color: #475569;
    }

    .speed-slider {
      width: 100px;
    }
  </style>
</head>
<body>
  <div class="debug-info" id="debug-info" style="display: none;"></div>
  <div class="starfield"></div>
  <h1>BINGO</h1>
  
  <!-- Called Numbers Sequence Display -->
  <div class="sequence-display" id="sequence-display" style="display: none;">
    <div class="sequence-title">Called Numbers:</div>
    <div class="sequence-numbers" id="sequence-numbers">Start playing to see called numbers</div>
  </div>
  
  <div id="bingo-letters"></div>
  <div class="game-container">
    <div id="setup-panel" class="setup-panel"></div>
    
    <!-- VS Computer Interface -->
    <div class="vs-computer-interface" id="vs-computer-interface">
      <div class="player-section">
        <div class="player-title you">🎯 Your Grid</div>
        <div class="player-bingo-letters" id="player-bingo-letters"></div>
        <div id="player-container"></div>
      </div>
      
      <div class="called-number-display">
        <div class="turn-indicator" id="turn-indicator">Your Turn</div>
        <div class="called-number" id="called-number">-</div>
        <div class="called-label">Last Called</div>
        <div style="font-size: 14px; color: #64748b; margin-top: 10px; text-align: center;">
          Click a number on your grid to call it!
        </div>
      </div>
      
      <div class="player-section">
        <div class="player-title computer">🤖 Computer</div>
        <div class="player-bingo-letters computer-bingo-letters" id="computer-bingo-letters"></div>
        <div id="computer-container" class="computer-grid"></div>
      </div>
    </div>
    
    <div id="container" style="display:none;"></div>
    <div style="text-align: center;">
      <button id="reset-btn" class="btn" onclick="resetGame()" style="display:none;">🔄 Reset Game</button>
      <button class="btn" onclick="toggleDebug()" style="display:none;" id="debug-btn">🐛 Debug</button>
      <button class="btn" onclick="showInstructions()" id="help-btn">❓ Instructions</button>
    </div>
  </div>
  
  <div class="confetti-container" id="confetti-container"></div>
  <div class="fireworks-container" id="fireworks-container"></div>

  <!-- Instruction Modal -->
  <div class="modal-overlay" id="instruction-modal" style="display: none;">
    <div class="modal">
      <h2>🎯 How to Play BINGO</h2>
      
      <p><strong>Game Modes:</strong></p>
      <p>• <span class="highlight">🎯 Solo Play</span> - Classic single-player BINGO</p>
      <p>• <span class="highlight">🤖 VS Computer</span> - Turn-based competition!</p>
      
      <p><strong>Setup Phase:</strong></p>
      <p>• Click on empty cells to place numbers 1-25</p>
      <p>• Use <span class="highlight">🎲 Randomize</span> for quick setup</p>
      <p>• Click <span class="highlight">🚀 Start Game</span> when ready</p>
      
      <p><strong>Game Phase:</strong></p>
      <p>• <strong>Solo:</strong> Click numbers to mark them as called</p>
      <p>• <strong>VS Computer:</strong> Take turns - click a number on your grid to call it. That number gets marked on <span class="highlight">both grids</span></p>
      <p>• Complete <span class="highlight">rows or columns</span> to strike BINGO letters</p>
      <p>• First to get all 5 letters wins!</p>
      
      <p><small>💡 You can view these instructions anytime using the <span class="highlight">❓ Instructions</span> button</small></p>
      
      <button class="btn" onclick="hideInstructions()">Got it! 🎮</button>
    </div>
  </div>

  <!-- Win Overlay -->
  <div class="win-overlay" id="win-overlay">
    <div class="win-content">
      <div class="win-title">🏆 BINGO! 🏆</div>
      <div class="win-subtitle">Congratulations, You Won!</div>
      <div class="win-sequence">
        <div class="win-sequence-title">Numbers Called:</div>
        <div class="win-sequence-numbers" id="win-sequence-numbers"></div>
      </div>
      <button class="btn" onclick="hideWinOverlay()">Play Again</button>
    </div>
  </div>

<script>
const BINGO = ['B','I','N','G','O'];
let grid, strikes;
let started = false;
let setupGrid = [];
let nextNumber = 1;
const ROWS = 5, COLS = 5;
let debugMode = false;
let completedLinesTracker = []; // Track which specific lines are completed

// Computer opponent variables
let gameMode = 'single'; // 'single' or 'vsComputer'
let computerGrid, computerStrikes;
let calledNumbers = [];
let currentCalledNumber = null;
let gameEnded = false;
let isPlayerTurn = true; // Track whose turn it is
let turnIndicator = null;

// Initialize starfield
function createStarfield() {
  const starfield = document.querySelector('.starfield');
  for (let i = 0; i < 100; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    star.style.left = Math.random() * 100 + 'vw';
    star.style.top = Math.random() * 100 + 'vh';
    star.style.width = star.style.height = (Math.random() * 3 + 1) + 'px';
    star.style.animationDelay = Math.random() * 3 + 's';
    starfield.appendChild(star);
  }
}

function showSetupPanel() {
  loadSetupProgress();
  
  let html = '<div class="game-mode-selector">';
  html += '<h3>🎮 Choose Game Mode</h3>';
  html += '<div class="mode-buttons">';
  html += `<button class="mode-btn ${gameMode === 'single' ? 'active' : ''}" onclick="setGameMode('single')">🎯 Solo Play</button>`;
  html += `<button class="mode-btn ${gameMode === 'vsComputer' ? 'active' : ''}" onclick="setGameMode('vsComputer')">🤖 VS Computer</button>`;
  html += '</div>';
  html += '</div>';
  
  html += '<h3>🎯 Click cells to place numbers 1–25<br><small>Your progress is automatically saved!</small></h3>';
  html += '<div id="current-number">Next number: <span id="next-num">' + nextNumber + '</span></div>';
  html += '<table id="setup-table">';
  for (let i = 0; i < ROWS; i++) {
    html += '<tr>';
    for (let j = 0; j < COLS; j++) {
      const value = setupGrid[i][j] || '';
      const filled = setupGrid[i][j] ? 'filled' : '';
      html += `<td class="setup-cell ${filled}" onclick="placeNumber(${i},${j})" id="setup${i}${j}">${value}</td>`;
    }
    html += '</tr>';
  }
  html += '</table>';
  html += '<div>';
  html += `<button class="btn" onclick="randomizeGrid()">🎲 Randomize</button>`;
  html += `<button class="btn" onclick="clearSetup()">🗑️ Clear</button>`;
  html += `<button class="btn" onclick="startGame()">🚀 Start Game</button>`;
  html += '</div>';
  document.getElementById('setup-panel').innerHTML = html;
}

function saveSetupProgress() {
  localStorage.setItem('bingoSetupGrid', JSON.stringify(setupGrid));
  localStorage.setItem('bingoNextNumber', nextNumber.toString());
}

function loadSetupProgress() {
  const savedGrid = localStorage.getItem('bingoSetupGrid');
  const savedNext = localStorage.getItem('bingoNextNumber');
  
  if (savedGrid && savedNext) {
    setupGrid = JSON.parse(savedGrid);
    nextNumber = parseInt(savedNext);
  } else {
    setupGrid = Array.from({length:ROWS}, ()=>Array(COLS).fill(0));
    nextNumber = 1;
  }
}

function placeNumber(i, j) {
  if (nextNumber > 25) return;
  if (setupGrid[i][j] !== 0) return;
  
  setupGrid[i][j] = nextNumber;
  let cell = document.getElementById(`setup${i}${j}`);
  cell.innerText = nextNumber;
  cell.classList.add('filled');
  
  nextNumber++;
  document.getElementById('next-num').innerText = nextNumber > 25 ? '🎉 Done!' : nextNumber;
  saveSetupProgress();
}

function clearSetup() {
  setupGrid = Array.from({length:ROWS}, ()=>Array(COLS).fill(0));
  nextNumber = 1;
  localStorage.removeItem('bingoSetupGrid');
  localStorage.removeItem('bingoNextNumber');
  showSetupPanel();
}

function setGameMode(mode) {
  gameMode = mode;
  // Update button states
  document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  
  // Save game mode preference
  localStorage.setItem('bingoGameMode', mode);
}

function generateComputerGrid() {
  gameMode = mode;
  // Update button states
  document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  
  // Save game mode preference
  localStorage.setItem('bingoGameMode', mode);
}

function generateComputerGrid() {
  let nums = Array.from({length: 25}, (_,i) => i+1);
  // Shuffle array
  for (let i = nums.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [nums[i], nums[j]] = [nums[j], nums[i]];
  }
  
  // Convert to 5x5 grid
  computerGrid = [];
  for(let i=0; i<ROWS; i++) {
    computerGrid.push(nums.slice(i*5, (i+1)*5));
  }
  
  computerStrikes = Array.from({length:ROWS}, ()=>Array(COLS).fill(false));
}

function drawComputerGrid() {
  let html='<table>';
  for(let i=0;i<ROWS;i++) {
    html += '<tr>';
    for(let j=0;j<COLS;j++) {
      let num = computerGrid[i][j];
      let cls = computerStrikes[i][j] ? 'striked' : '';
      html += `<td class="${cls}">${num}</td>`;
    }
    html+='</tr>';
  }
  html+='</table>';
  document.getElementById('computer-container').innerHTML = html;
}

function drawPlayerGrid() {
  let html='<table>';
  for(let i=0;i<ROWS;i++) {
    html += '<tr>';
    for(let j=0;j<COLS;j++) {
      let num = grid[i][j];
      let cls = strikes[i][j] ? 'striked' : '';
      html += `<td class="${cls}" onclick="toggleStrike(${i},${j})">${num}</td>`;
    }
    html+='</tr>';
  }
  html+='</table>';
  document.getElementById('player-container').innerHTML = html;
}

function drawBingoLetters(containerId = 'bingo-letters', strikesArray = strikes, gridArray = grid) {
  // For solo mode, use the old countCompletedLines function
  const completedCount = containerId === 'bingo-letters' ? 
    countCompletedLines() : countCompletedLinesForGrid(strikesArray);
  
  let html='';
  for (let i = 0; i < 5; i++) {
    const isStruck = i < completedCount;
    const additionalClass = containerId === 'computer-bingo-letters' ? 'computer-bingo-letters' : '';
    html += `<span class="${isStruck ? 'striked' : ''} ${additionalClass}">${BINGO[i]}</span>`;
  }
  
  const element = document.getElementById(containerId);
  if (element) {
    element.innerHTML = html;
  }
}

function countCompletedLinesForGrid(strikesArray) {
  let completedLines = [];
  
  // Check each row
  for(let rowIndex = 0; rowIndex < ROWS; rowIndex++) {
    let rowComplete = true;
    for(let colIndex = 0; colIndex < COLS; colIndex++) {
      if(strikesArray[rowIndex][colIndex] !== true) {
        rowComplete = false;
        break;
      }
    }
    if(rowComplete) {
      completedLines.push(`row-${rowIndex}`);
    }
  }
  
  // Check each column
  for(let colIndex = 0; colIndex < COLS; colIndex++) {
    let columnComplete = true;
    for(let rowIndex = 0; rowIndex < ROWS; rowIndex++) {
      if(strikesArray[rowIndex][colIndex] !== true) {
        columnComplete = false;
        break;
      }
    }
    if(columnComplete) {
      completedLines.push(`col-${colIndex}`);
    }
  }
  
  return Math.min(completedLines.length, 5);
}

function playerCallNumber() {
  if (!isPlayerTurn || gameEnded) return;
  
  callNumber();
  switchTurn();
}

function computerCallNumber() {
  if (isPlayerTurn || gameEnded) return;
  
  // Computer picks a random number from its grid that hasn't been called
  let availableNumbers = [];
  for (let i = 0; i < ROWS; i++) {
    for (let j = 0; j < COLS; j++) {
      const num = computerGrid[i][j];
      if (!calledNumbers.includes(num)) {
        availableNumbers.push(num);
      }
    }
  }
  
  if (availableNumbers.length === 0) {
    endGame('draw');
    return;
  }
  
  // Computer takes time to "think"
  setTimeout(() => {
    if (gameEnded) return;
    
    // Pick random available number
    const randomIndex = Math.floor(Math.random() * availableNumbers.length);
    const computerNumber = availableNumbers[randomIndex];
    
    // Add to called numbers
    calledNumbers.push(computerNumber);
    currentCalledNumber = computerNumber;
    
    // Update sequence display
    updateSequenceDisplay();
    
    // Update display
    document.getElementById('called-number').textContent = computerNumber;
    
    // Mark on both grids
    markNumberOnGrid(computerNumber, grid, strikes);
    markNumberOnGrid(computerNumber, computerGrid, computerStrikes);
    
    // Add visual highlight
    highlightCalledNumber(computerNumber);
    
    // Redraw grids
    drawPlayerGrid();
    drawComputerGrid();
    drawBingoLetters('player-bingo-letters', strikes, grid);
    drawBingoLetters('computer-bingo-letters', computerStrikes, computerGrid);
    
    // Check for wins
    if (countCompletedLinesForGrid(strikes) === 5) {
      endGame('player');
    } else if (countCompletedLinesForGrid(computerStrikes) === 5) {
      endGame('computer');
    } else {
      // Switch turn back to player
      switchTurn();
    }
    
    saveState();
  }, 1000 + Math.random() * 2000); // 1-3 seconds
}

function switchTurn() {
  isPlayerTurn = !isPlayerTurn;
  updateTurnIndicator();
  saveState(); // Save turn state
  
  // If it's computer's turn, let computer play
  if (!isPlayerTurn && gameMode === 'vsComputer') {
    computerCallNumber();
  }
}

function updateTurnIndicator() {
  const indicator = document.getElementById('turn-indicator');
  
  if (isPlayerTurn) {
    indicator.textContent = '🎯 Your Turn - Click a number!';
    indicator.className = 'turn-indicator player-turn';
  } else {
    indicator.textContent = '🤖 Computer\'s Turn';
    indicator.className = 'turn-indicator computer-turn';
  }
}

function callNumber() {
  if (gameEnded) return;
  
  // Generate list of uncalled numbers
  let availableNumbers = [];
  for (let i = 1; i <= 25; i++) {
    if (!calledNumbers.includes(i)) {
      availableNumbers.push(i);
    }
  }
  
  if (availableNumbers.length === 0) {
    // All numbers called, end game
    endGame('draw');
    return;
  }
  
  // Pick random uncalled number
  const randomIndex = Math.floor(Math.random() * availableNumbers.length);
  currentCalledNumber = availableNumbers[randomIndex];
  calledNumbers.push(currentCalledNumber);
  
  // Update display
  document.getElementById('called-number').textContent = currentCalledNumber;
  document.getElementById('numbers-left').textContent = availableNumbers.length - 1;
  
  // Mark number on both grids (this is the key fix!)
  markNumberOnGrid(currentCalledNumber, grid, strikes);
  if (gameMode === 'vsComputer') {
    markNumberOnGrid(currentCalledNumber, computerGrid, computerStrikes);
  }
  
  // Add visual highlight to called number
  highlightCalledNumber(currentCalledNumber);
  
  // Redraw grids
  if (gameMode === 'vsComputer') {
    drawPlayerGrid();
    drawComputerGrid();
    drawBingoLetters('player-bingo-letters', strikes, grid);
    drawBingoLetters('computer-bingo-letters', computerStrikes, computerGrid);
  }
  
  // Check for wins
  if (countCompletedLinesForGrid(strikes) === 5) {
    endGame('player');
  } else if (gameMode === 'vsComputer' && countCompletedLinesForGrid(computerStrikes) === 5) {
    endGame('computer');
  }
  
  // Save state after each number call
  saveState();
}

function highlightCalledNumber(number) {
  // Add temporary highlight to show which number was just called
  setTimeout(() => {
    const cells = document.querySelectorAll('td');
    cells.forEach(cell => {
      if (cell.textContent == number) {
        cell.style.animation = 'numberHighlight 1s ease-out';
        setTimeout(() => {
          cell.style.animation = '';
        }, 1000);
      }
    });
  }, 100);
}

function markNumberOnGrid(number, gridArray, strikesArray) {
  for (let i = 0; i < ROWS; i++) {
    for (let j = 0; j < COLS; j++) {
      if (gridArray[i][j] === number) {
        strikesArray[i][j] = true;
        return;
      }
    }
  }
}

function updateSequenceDisplay() {
  const sequenceContainer = document.getElementById('sequence-numbers');
  if (!sequenceContainer) return;
  
  if (calledNumbers.length === 0) {
    sequenceContainer.innerHTML = 'Start playing to see called numbers';
    sequenceContainer.style.color = '#64748b';
    return;
  }
  
  // Clear existing content
  sequenceContainer.innerHTML = '';
  sequenceContainer.style.color = 'initial';
  
  // Add each called number as a styled element
  calledNumbers.forEach((number, index) => {
    const numberSpan = document.createElement('span');
    numberSpan.className = 'sequence-number';
    numberSpan.textContent = number;
    
    // Add slight delay for animation
    setTimeout(() => {
      sequenceContainer.appendChild(numberSpan);
    }, index * 50);
  });
}

function showSequenceDisplay() {
  document.getElementById('sequence-display').style.display = 'block';
  updateSequenceDisplay();
}

function hideSequenceDisplay() {
  document.getElementById('sequence-display').style.display = 'none';
}

function endGame(winner) {
  gameEnded = true;
  
  // Update turn indicator to show game over
  const indicator = document.getElementById('turn-indicator');
  if (indicator) {
    indicator.textContent = '🏁 Game Over';
    indicator.className = 'turn-indicator';
  }
  
  // Show appropriate win message
  setTimeout(() => {
    createConfetti();
    createFireworks();
    setTimeout(() => {
      if (winner === 'player') {
        showWinOverlay('🏆 BINGO! You Won!', 'Congratulations, you beat the computer!');
      } else if (winner === 'computer') {
        showWinOverlay('🤖 Computer Wins!', 'Better luck next time!');
      } else {
        showWinOverlay('🤝 It\'s a Draw!', 'All numbers called, no winner!');
      }
    }, 500);
  }, 300);
}

function switchTurn() {
  isPlayerTurn = !isPlayerTurn;
  updateTurnIndicator();
  saveState(); // Save turn state
  
  // If it's computer's turn, let computer play
  if (!isPlayerTurn && gameMode === 'vsComputer') {
    computerCallNumber();
  }
}

function highlightCalledNumber(number) {
  // Add temporary highlight to show which number was just called
  setTimeout(() => {
    const cells = document.querySelectorAll('td');
    cells.forEach(cell => {
      if (cell.textContent == number) {
        cell.style.animation = 'numberHighlight 1s ease-out';
        setTimeout(() => {
          cell.style.animation = '';
        }, 1000);
      }
    });
  }, 100);
}

function clearSetup() {
  setupGrid = Array.from({length:ROWS}, ()=>Array(COLS).fill(0));
  nextNumber = 1;
  localStorage.removeItem('bingoSetupGrid');
  localStorage.removeItem('bingoNextNumber');
  showSetupPanel();
}

function randomizeGrid() {
  let nums = Array.from({length: 25}, (_,i) => i+1);
  for (let i = nums.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [nums[i], nums[j]] = [nums[j], nums[i]];
  }
  
  setupGrid = [];
  for(let i=0; i<ROWS; i++) {
    setupGrid.push(nums.slice(i*5, (i+1)*5));
  }
  
  nextNumber = 26;
  saveSetupProgress();
  showSetupPanel();
}

function startGame() {
  let filled = 0;
  let used = new Set();
  
  for(let i=0; i<ROWS; i++){
    for(let j=0; j<COLS; j++){
      if(setupGrid[i][j] !== 0) {
        filled++;
        used.add(setupGrid[i][j]);
      }
    }
  }
  
  if(filled !== 25 || used.size !== 25) {
    alert("🚫 Please fill all cells with numbers 1-25 before starting!");
    return;
  }
  
  grid = setupGrid.map(row => [...row]);
  strikes = Array.from({length:ROWS}, ()=>Array(COLS).fill(false));
  completedLinesTracker = []; // Reset completed lines tracker
  started = true;
  gameEnded = false;
  calledNumbers = [];
  currentCalledNumber = null;
  
  // Randomly decide who starts (or let player choose in future)
  isPlayerTurn = Math.random() < 0.5;
  
  // Setup computer if vs computer mode
  if (gameMode === 'vsComputer') {
    generateComputerGrid();
  }
  
  // Clear any existing game state to ensure fresh start
  localStorage.removeItem('bingoGrid');
  localStorage.removeItem('bingoStrikes');
  localStorage.removeItem('bingoStarted');
  localStorage.removeItem('bingoSetupGrid');
  localStorage.removeItem('bingoNextNumber');
  
  saveState();
  document.getElementById('setup-panel').style.display='none';
  
  // Show sequence display
  showSequenceDisplay();
  
  if (gameMode === 'vsComputer') {
    document.getElementById('vs-computer-interface').style.display='grid';
    document.getElementById('container').style.display='none';
    document.getElementById('bingo-letters').style.display='none'; // Hide main BINGO letters
    drawPlayerGrid();
    drawComputerGrid();
    drawBingoLetters('player-bingo-letters', strikes, grid);
    drawBingoLetters('computer-bingo-letters', computerStrikes, computerGrid);
    updateTurnIndicator();
    
    // If computer starts, let it make the first move
    if (!isPlayerTurn) {
      computerCallNumber();
    }
  } else {
    document.getElementById('vs-computer-interface').style.display='none';
    document.getElementById('container').style.display='';
    document.getElementById('bingo-letters').style.display='flex'; // Show main BINGO letters
    drawGrid();
  }
  
  document.getElementById('reset-btn').style.display='';
  document.getElementById('debug-btn').style.display='';
}

function loadState() {
  let g = localStorage.getItem('bingoGrid');
  let s = localStorage.getItem('bingoStrikes');
  let st = localStorage.getItem('bingoStarted');
  let mode = localStorage.getItem('bingoGameMode');
  
  if (g && s && st==='yes') {
    grid = JSON.parse(g);
    strikes = JSON.parse(s);
    started = true;
    
    // Load game mode
    if (mode) {
      gameMode = mode;
    }
    
    // Load called numbers for solo mode too
    let cn = localStorage.getItem('bingoCalledNumbers');
    if (cn) {
      calledNumbers = JSON.parse(cn);
    }
    
    document.getElementById('setup-panel').style.display='none';
    document.getElementById('reset-btn').style.display='';
    document.getElementById('debug-btn').style.display='';
    
    // Show sequence display for any started game
    showSequenceDisplay();
    
    if (gameMode === 'vsComputer') {
      // Load VS Computer specific state
      let cg = localStorage.getItem('bingoComputerGrid');
      let cs = localStorage.getItem('bingoComputerStrikes');
      let ccn = localStorage.getItem('bingoCurrentCalledNumber');
      let pt = localStorage.getItem('bingoIsPlayerTurn');
      let ge = localStorage.getItem('bingoGameEnded');
      
      if (cg && cs) {
        computerGrid = JSON.parse(cg);
        computerStrikes = JSON.parse(cs);
        currentCalledNumber = ccn || null;
        isPlayerTurn = pt === 'yes';
        gameEnded = ge === 'yes';
        
        // Setup VS Computer interface
        document.getElementById('vs-computer-interface').style.display='grid';
        document.getElementById('container').style.display='none';
        document.getElementById('bingo-letters').style.display='none'; // Hide main BINGO letters
        
        // Update displays
        drawPlayerGrid();
        drawComputerGrid();
        drawBingoLetters('player-bingo-letters', strikes, grid);
        drawBingoLetters('computer-bingo-letters', computerStrikes, computerGrid);
        updateTurnIndicator();
        
        // Update called number display
        if (currentCalledNumber) {
          document.getElementById('called-number').textContent = currentCalledNumber;
        }
        
        // If it's computer's turn and game isn't ended, let computer play
        if (!isPlayerTurn && !gameEnded) {
          setTimeout(() => {
            computerCallNumber();
          }, 2000);
        }
        
        return true;
      } else {
        // Incomplete VS Computer state, force restart
        return false;
      }
    } else {
      // Solo mode
      document.getElementById('vs-computer-interface').style.display='none';
      document.getElementById('container').style.display='';
      document.getElementById('bingo-letters').style.display='flex'; // Show main BINGO letters
      drawGrid();
      return true;
    }
  }
  return false;
}

function saveState() {
  localStorage.setItem('bingoGrid', JSON.stringify(grid));
  localStorage.setItem('bingoStrikes', JSON.stringify(strikes));
  localStorage.setItem('bingoStarted', started?'yes':'no');
  localStorage.setItem('bingoGameMode', gameMode);
  localStorage.setItem('bingoCalledNumbers', JSON.stringify(calledNumbers));
  
  // Save VS Computer specific state
  if (gameMode === 'vsComputer') {
    localStorage.setItem('bingoComputerGrid', JSON.stringify(computerGrid));
    localStorage.setItem('bingoComputerStrikes', JSON.stringify(computerStrikes));
    localStorage.setItem('bingoCurrentCalledNumber', currentCalledNumber || '');
    localStorage.setItem('bingoIsPlayerTurn', isPlayerTurn ? 'yes' : 'no');
    localStorage.setItem('bingoGameEnded', gameEnded ? 'yes' : 'no');
  }
}

function resetGame() {
  // Clear all localStorage
  localStorage.removeItem('bingoGrid');
  localStorage.removeItem('bingoStrikes');
  localStorage.removeItem('bingoStarted');
  localStorage.removeItem('bingoComputerGrid');
  localStorage.removeItem('bingoComputerStrikes');
  localStorage.removeItem('bingoCalledNumbers');
  localStorage.removeItem('bingoCurrentCalledNumber');
  localStorage.removeItem('bingoIsPlayerTurn');
  localStorage.removeItem('bingoGameEnded');
  localStorage.removeItem('bingoSetupGrid');
  localStorage.removeItem('bingoNextNumber');
  // Keep game mode preference
  
  // Hide sequence display
  hideSequenceDisplay();
  
  location.reload();
}

function drawGrid() {
  let html='<table>';
  for(let i=0;i<ROWS;i++) {
    html += '<tr>';
    for(let j=0;j<COLS;j++) {
      let num = grid[i][j];
      let cls = strikes[i][j] ? 'striked' : '';
      html += `<td class="${cls}" onclick="toggleStrike(${i},${j})">${num}</td>`;
    }
    html+='</tr>';
  }
  html+='</table>';
  document.getElementById('container').innerHTML = html;
  drawBingoLetters(); // Update main BINGO letters
  updateDebugInfo();
}

function toggleStrike(i,j){
  if (gameMode === 'single') {
    // Solo mode - allow toggling but prevent unselecting if number was called
    const clickedNumber = grid[i][j];
    
    if (strikes[i][j]) {
      // Trying to unselect - check if this number was called
      if (calledNumbers.includes(clickedNumber)) {
        // Don't allow unselecting a number that was previously called
        return;
      }
      // Remove from called numbers if not manually called
      const index = calledNumbers.indexOf(clickedNumber);
      if (index > -1) {
        calledNumbers.splice(index, 1);
        updateSequenceDisplay();
      }
    } else {
      // Selecting - add to called numbers if not already there
      if (!calledNumbers.includes(clickedNumber)) {
        calledNumbers.push(clickedNumber);
        updateSequenceDisplay();
      }
    }
    
    strikes[i][j]=!strikes[i][j];
    saveState();
    drawGrid();
    checkWin();
  } else if (gameMode === 'vsComputer') {
    // VS Computer mode - turn-based gameplay
    if (!isPlayerTurn || gameEnded) {
      return; // Not player's turn or game ended
    }
    
    // Get the number that was clicked
    const clickedNumber = grid[i][j];
    
    // Check if this number was already called
    if (calledNumbers.includes(clickedNumber)) {
      // Don't allow any changes to previously called numbers
      return;
    } else {
      // This is a new number call - player's turn
      calledNumbers.push(clickedNumber);
      currentCalledNumber = clickedNumber;
      
      // Update sequence display
      updateSequenceDisplay();
      
      // Update display
      document.getElementById('called-number').textContent = clickedNumber;
      
      // Mark this number on both grids
      markNumberOnGrid(clickedNumber, grid, strikes);
      markNumberOnGrid(clickedNumber, computerGrid, computerStrikes);
      
      // Add visual highlight
      highlightCalledNumber(clickedNumber);
      
      // Switch turn to computer
      switchTurn();
    }
    
    // Redraw grids and update BINGO letters
    drawPlayerGrid();
    drawComputerGrid();
    drawBingoLetters('player-bingo-letters', strikes, grid);
    drawBingoLetters('computer-bingo-letters', computerStrikes, computerGrid);
    
    // Check for wins
    if (countCompletedLinesForGrid(strikes) === 5) {
      endGame('player');
    } else if (countCompletedLinesForGrid(computerStrikes) === 5) {
      endGame('computer');
    }
    
    saveState();
  }
}

// FIXED: Proper line completion tracking
function countCompletedLines() {
  let completedLines = [];
  
  // Check each row
  for(let rowIndex = 0; rowIndex < ROWS; rowIndex++) {
    let rowComplete = true;
    for(let colIndex = 0; colIndex < COLS; colIndex++) {
      if(strikes[rowIndex][colIndex] !== true) {
        rowComplete = false;
        break;
      }
    }
    if(rowComplete) {
      completedLines.push(`row-${rowIndex}`);
    }
  }
  
  // Check each column
  for(let colIndex = 0; colIndex < COLS; colIndex++) {
    let columnComplete = true;
    for(let rowIndex = 0; rowIndex < ROWS; rowIndex++) {
      if(strikes[rowIndex][colIndex] !== true) {
        columnComplete = false;
        break;
      }
    }
    if(columnComplete) {
      completedLines.push(`col-${colIndex}`);
    }
  }
  
  // Update the tracker and return count (max 5 for B-I-N-G-O)
  completedLinesTracker = completedLines;
  return Math.min(completedLines.length, 5);
}

function toggleDebug() {
  debugMode = !debugMode;
  document.getElementById('debug-info').style.display = debugMode ? 'block' : 'none';
  updateDebugInfo();
}

function updateDebugInfo() {
  if (!debugMode) return;
  
  const completedCount = countCompletedLines();
  let debugText = `Completed Lines: ${completedCount}\n`;
  debugText += `Completed: ${completedLinesTracker.join(', ')}\n\n`;
  
  // Show total strikes count
  let totalStrikes = 0;
  for(let i = 0; i < ROWS; i++) {
    for(let j = 0; j < COLS; j++) {
      if(strikes[i][j]) totalStrikes++;
    }
  }
  debugText += `Total Strikes: ${totalStrikes}/25\n\n`;
  
  // Show row completion status
  debugText += "Rows:\n";
  for(let i = 0; i < ROWS; i++) {
    const rowComplete = strikes[i].every(cell => cell === true);
    const strikeCount = strikes[i].filter(cell => cell === true).length;
    debugText += `Row ${i}: ${strikeCount}/5 ${rowComplete ? '✓ COMPLETE' : ''}\n`;
  }
  
  // Show column completion status
  debugText += "\nColumns:\n";
  for(let j = 0; j < COLS; j++) {
    let colStrikeCount = 0;
    let colComplete = true;
    for(let i = 0; i < ROWS; i++) {
      if(strikes[i][j]) colStrikeCount++;
      if(!strikes[i][j]) colComplete = false;
    }
    debugText += `Col ${j}: ${colStrikeCount}/5 ${colComplete ? '✓ COMPLETE' : ''}\n`;
  }
  
  document.getElementById('debug-info').innerText = debugText;
}

// Enhanced winning animations
function createConfetti() {
  const container = document.getElementById('confetti-container');
  container.style.display = 'block';
  container.innerHTML = '';
  
  const colors = ['#6366f1', '#8b5cf6', '#a855f7', '#e879f9', '#94a3b8', '#64748b'];
  
  for (let i = 0; i < 200; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * 100 + 'vw';
    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.animationDelay = Math.random() * 2 + 's';
    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
    container.appendChild(confetti);
  }
  
  setTimeout(() => {
    container.style.display = 'none';
    container.innerHTML = '';
  }, 5000);
}

function createFireworks() {
  const container = document.getElementById('fireworks-container');
  container.style.display = 'block';
  container.innerHTML = '';
  
  const colors = ['#6366f1', '#8b5cf6', '#a855f7', '#e879f9', '#94a3b8', '#64748b'];
  
  for (let burst = 0; burst < 8; burst++) {
    setTimeout(() => {
      const centerX = Math.random() * window.innerWidth;
      const centerY = Math.random() * window.innerHeight * 0.6;
      
      for (let i = 0; i < 30; i++) {
        const firework = document.createElement('div');
        firework.className = 'firework';
        firework.style.left = centerX + 'px';
        firework.style.top = centerY + 'px';
        firework.style.background = colors[Math.floor(Math.random() * colors.length)];
        
        const angle = (i * 12) * Math.PI / 180;
        const distance = Math.random() * 200 + 100;
        const dx = Math.cos(angle) * distance;
        const dy = Math.sin(angle) * distance;
        
        firework.style.setProperty('--dx', dx + 'px');
        firework.style.setProperty('--dy', dy + 'px');
        
        container.appendChild(firework);
        
        setTimeout(() => firework.remove(), 1500);
      }
    }, burst * 300);
  }
  
  setTimeout(() => {
    container.style.display = 'none';
  }, 4000);
}

function checkWin() {
  if (countCompletedLines() === 5) {
    if (gameMode === 'vsComputer') {
      endGame('player');
    } else {
      setTimeout(() => {
        createConfetti();
        createFireworks();
        setTimeout(() => {
          showWinOverlay();
        }, 500);
      }, 300);
    }
  }
}

// Modal and overlay functions
function showInstructions() {
  document.getElementById('instruction-modal').style.display = 'flex';
}

function hideInstructions() {
  document.getElementById('instruction-modal').style.display = 'none';
  // Mark that user has seen instructions
  localStorage.setItem('bingoInstructionsSeen', 'true');
}

function showWinOverlay(title = '🏆 BINGO! 🏆', subtitle = 'Congratulations, You Won!') {
  document.querySelector('.win-title').textContent = title;
  document.querySelector('.win-subtitle').textContent = subtitle;
  
  // Update the win sequence display
  const winSequenceContainer = document.getElementById('win-sequence-numbers');
  if (winSequenceContainer && calledNumbers.length > 0) {
    winSequenceContainer.innerHTML = '';
    calledNumbers.forEach(number => {
      const numberSpan = document.createElement('span');
      numberSpan.className = 'sequence-number';
      numberSpan.textContent = number;
      winSequenceContainer.appendChild(numberSpan);
    });
  } else if (winSequenceContainer) {
    winSequenceContainer.innerHTML = '<span style="color: rgba(255,255,255,0.7);">No numbers called</span>';
  }
  
  document.getElementById('win-overlay').style.display = 'flex';
}

function hideWinOverlay() {
  document.getElementById('win-overlay').style.display = 'none';
  resetGame();
}

// Check if this is the very first visit ever
function checkFirstVisit() {
  const hasSeenInstructions = localStorage.getItem('bingoInstructionsSeen');
  const hasAnyGameData = localStorage.getItem('bingoGrid') || 
                        localStorage.getItem('bingoSetupGrid') || 
                        localStorage.getItem('bingoStarted');
  
  // Only show instructions if user has never seen them AND has no game data
  if (!hasSeenInstructions && !hasAnyGameData) {
    showInstructions();
  }
}

// Initialize
createStarfield();

// Load game mode preference
const savedGameMode = localStorage.getItem('bingoGameMode');
if (savedGameMode) {
  gameMode = savedGameMode;
}

if(!loadState()) {
  showSetupPanel();
  // Initialize BINGO letters as unstriked when starting fresh
  let html='';
  for (let i = 0; i < 5; i++) {
    html += `<span class="">${BINGO[i]}</span>`;
  }
  document.getElementById('bingo-letters').innerHTML = html;
} else {
  // State was loaded successfully
  console.log('Game state restored successfully');
}

// Check for first visit after everything is loaded
setTimeout(checkFirstVisit, 500);
</script>
</body>
</html>
