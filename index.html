<!DOCTYPE html>
<html>
<head>
  <title>Ultimate Bingo Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      overflow-x: hidden;
    }
    
    .starfield {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: -1;
    }
    
    .star {
      position: absolute;
      background: rgba(255,255,255,0.8);
      border-radius: 50%;
      animation: twinkle 3s infinite;
    }
    
    @keyframes twinkle {
      0%, 100% { opacity: 0.3; transform: scale(0.8); }
      50% { opacity: 1; transform: scale(1.2); }
    }
    
    h1 {
      font-size: clamp(48px, 8vw, 72px);
      font-weight: 900;
      letter-spacing: 12px;
      text-shadow: 0 0 30px rgba(255,255,255,0.8), 0 0 60px rgba(102,126,234,0.6);
      margin-bottom: 30px;
      background: linear-gradient(45deg, #fff, #f093fb, #667eea);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: glow 3s ease-in-out infinite alternate;
    }
    
    @keyframes glow {
      from { filter: drop-shadow(0 0 20px rgba(255,255,255,0.5)); }
      to { filter: drop-shadow(0 0 40px rgba(240,147,251,0.8)); }
    }
    
    #bingo-letters {
      display: flex;
      gap: 20px;
      margin-bottom: 40px;
      perspective: 1000px;
    }
    
    #bingo-letters span {
      width: 60px; height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      font-weight: bold;
      border-radius: 50%;
      background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255,255,255,0.3);
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      transform-style: preserve-3d;
    }
    
    #bingo-letters span.striked {
      background: linear-gradient(135deg, #f093fb, #667eea);
      transform: rotateY(180deg) scale(1.1);
      box-shadow: 0 0 30px rgba(240,147,251,0.6), 0 8px 32px rgba(0,0,0,0.2);
      text-decoration: line-through;
      animation: letterStrike 0.8s ease-out;
    }
    
    @keyframes letterStrike {
      0% { transform: rotateY(0deg) scale(1); }
      50% { transform: rotateY(90deg) scale(1.2); }
      100% { transform: rotateY(180deg) scale(1.1); }
    }
    
    .game-container {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(20px);
      border-radius: 30px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.2);
      max-width: 600px;
      width: 90vw;
    }
    
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 8px;
      margin-bottom: 30px;
    }
    
    td {
      width: 80px;
      height: 80px;
      border-radius: 20px;
      font-size: 28px;
      font-weight: bold;
      text-align: center;
      cursor: pointer;
      position: relative;
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
      color: #333;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      border: 2px solid transparent;
    }
    
    td:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }
    
    td.setup-cell {
      background: linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.1));
      border: 2px dashed rgba(255,255,255,0.5);
      color: rgba(255,255,255,0.7);
    }
    
    td.setup-cell:hover {
      background: linear-gradient(135deg, rgba(255,255,255,0.4), rgba(255,255,255,0.2));
      border: 2px solid rgba(255,255,255,0.7);
    }
    
    td.setup-cell.filled {
      background: linear-gradient(135deg, #f093fb, #667eea);
      color: #fff;
      border: 2px solid rgba(255,255,255,0.5);
      animation: fillPop 0.4s ease-out;
    }
    
    @keyframes fillPop {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    td.striked {
      background: linear-gradient(135deg, #667eea, #764ba2) !important;
      color: #fff !important;
      transform: scale(0.95);
      animation: strikeEffect 0.5s ease-out;
      box-shadow: 0 0 20px rgba(102,126,234,0.5);
    }
    
    @keyframes strikeEffect {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); background: linear-gradient(135deg, #f093fb, #667eea); }
      100% { transform: scale(0.95); }
    }
    
    .btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      border: none;
      border-radius: 25px;
      padding: 15px 30px;
      font-size: 18px;
      font-weight: bold;
      margin: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
      position: relative;
      overflow: hidden;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    #current-number {
      text-align: center;
      font-size: 24px;
      margin: 20px 0;
      padding: 15px;
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }
    
    .setup-panel {
      text-align: center;
    }
    
    .setup-panel h3 {
      margin-bottom: 25px;
      font-size: 24px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    /* Debug info */
    .debug-info {
      position: fixed;
      top: 10px; left: 10px;
      background: rgba(0,0,0,0.7);
      color: #fff;
      padding: 10px;
      border-radius: 10px;
      font-size: 12px;
      font-family: monospace;
      z-index: 1001;
      max-width: 300px;
    }
    
    /* Confetti Animation */
    .confetti-container {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: 1000;
      display: none;
    }
    
    .confetti {
      position: absolute;
      width: 10px; height: 10px;
      background: #f093fb;
      animation: confettiFall 3s linear forwards;
    }
    
    @keyframes confettiFall {
      0% {
        transform: translateY(-100vh) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
    
    /* Fireworks Animation */
    .fireworks-container {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: 999;
      display: none;
    }
    
    .firework {
      position: absolute;
      width: 4px; height: 4px;
      border-radius: 50%;
      animation: explode 1.5s ease-out forwards;
    }
    
    @keyframes explode {
      0% {
        transform: translate(0, 0) scale(0);
        opacity: 1;
      }
      100% {
        transform: translate(var(--dx), var(--dy)) scale(1);
        opacity: 0;
      }
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      td { width: 60px; height: 60px; font-size: 22px; }
      h1 { font-size: 48px; letter-spacing: 6px; }
      #bingo-letters span { width: 50px; height: 50px; font-size: 28px; }
    }
  </style>
</head>
<body>
  <div class="debug-info" id="debug-info" style="display: none;"></div>
  <div class="starfield"></div>
  <h1>BINGO</h1>
  <div id="bingo-letters"></div>
  <div class="game-container">
    <div id="setup-panel" class="setup-panel"></div>
    <div id="container" style="display:none;"></div>
    <div style="text-align: center;">
      <button id="reset-btn" class="btn" onclick="resetGame()" style="display:none;">üîÑ Reset Game</button>
      <button class="btn" onclick="toggleDebug()" style="display:none;" id="debug-btn">üêõ Debug</button>
    </div>
  </div>
  
  <div class="confetti-container" id="confetti-container"></div>
  <div class="fireworks-container" id="fireworks-container"></div>

<script>
const BINGO = ['B','I','N','G','O'];
let grid, strikes;
let started = false;
let setupGrid = [];
let nextNumber = 1;
const ROWS = 5, COLS = 5;
let debugMode = false;

// Initialize starfield
function createStarfield() {
  const starfield = document.querySelector('.starfield');
  for (let i = 0; i < 100; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    star.style.left = Math.random() * 100 + 'vw';
    star.style.top = Math.random() * 100 + 'vh';
    star.style.width = star.style.height = (Math.random() * 3 + 1) + 'px';
    star.style.animationDelay = Math.random() * 3 + 's';
    starfield.appendChild(star);
  }
}

function showSetupPanel() {
  loadSetupProgress();
  
  let html = '<h3>üéØ Click cells to place numbers 1‚Äì25<br><small>Your progress is automatically saved!</small></h3>';
  html += '<div id="current-number">Next number: <span id="next-num">' + nextNumber + '</span></div>';
  html += '<table id="setup-table">';
  for (let i = 0; i < ROWS; i++) {
    html += '<tr>';
    for (let j = 0; j < COLS; j++) {
      const value = setupGrid[i][j] || '';
      const filled = setupGrid[i][j] ? 'filled' : '';
      html += `<td class="setup-cell ${filled}" onclick="placeNumber(${i},${j})" id="setup${i}${j}">${value}</td>`;
    }
    html += '</tr>';
  }
  html += '</table>';
  html += '<div>';
  html += `<button class="btn" onclick="randomizeGrid()">üé≤ Randomize</button>`;
  html += `<button class="btn" onclick="clearSetup()">üóëÔ∏è Clear</button>`;
  html += `<button class="btn" onclick="startGame()">üöÄ Start Game</button>`;
  html += '</div>';
  document.getElementById('setup-panel').innerHTML = html;
}

function saveSetupProgress() {
  localStorage.setItem('bingoSetupGrid', JSON.stringify(setupGrid));
  localStorage.setItem('bingoNextNumber', nextNumber.toString());
}

function loadSetupProgress() {
  const savedGrid = localStorage.getItem('bingoSetupGrid');
  const savedNext = localStorage.getItem('bingoNextNumber');
  
  if (savedGrid && savedNext) {
    setupGrid = JSON.parse(savedGrid);
    nextNumber = parseInt(savedNext);
  } else {
    setupGrid = Array.from({length:ROWS}, ()=>Array(COLS).fill(0));
    nextNumber = 1;
  }
}

function placeNumber(i, j) {
  if (nextNumber > 25) return;
  if (setupGrid[i][j] !== 0) return;
  
  setupGrid[i][j] = nextNumber;
  let cell = document.getElementById(`setup${i}${j}`);
  cell.innerText = nextNumber;
  cell.classList.add('filled');
  
  nextNumber++;
  document.getElementById('next-num').innerText = nextNumber > 25 ? 'üéâ Done!' : nextNumber;
  saveSetupProgress();
}

function clearSetup() {
  setupGrid = Array.from({length:ROWS}, ()=>Array(COLS).fill(0));
  nextNumber = 1;
  localStorage.removeItem('bingoSetupGrid');
  localStorage.removeItem('bingoNextNumber');
  showSetupPanel();
}

function randomizeGrid() {
  let nums = Array.from({length: 25}, (_,i) => i+1);
  for (let i = nums.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [nums[i], nums[j]] = [nums[j], nums[i]];
  }
  
  setupGrid = [];
  for(let i=0; i<ROWS; i++) {
    setupGrid.push(nums.slice(i*5, (i+1)*5));
  }
  
  nextNumber = 26;
  saveSetupProgress();
  showSetupPanel();
}

function startGame() {
  let filled = 0;
  let used = new Set();
  
  for(let i=0; i<ROWS; i++){
    for(let j=0; j<COLS; j++){
      if(setupGrid[i][j] !== 0) {
        filled++;
        used.add(setupGrid[i][j]);
      }
    }
  }
  
  if(filled !== 25 || used.size !== 25) {
    alert("üö´ Please fill all cells with numbers 1-25 before starting!");
    return;
  }
  
  grid = setupGrid.map(row => [...row]);
  strikes = Array.from({length:ROWS}, ()=>Array(COLS).fill(false));
  started = true;
  
  localStorage.removeItem('bingoSetupGrid');
  localStorage.removeItem('bingoNextNumber');
  
  saveState();
  document.getElementById('setup-panel').style.display='none';
  document.getElementById('container').style.display='';
  document.getElementById('reset-btn').style.display='';
  document.getElementById('debug-btn').style.display='';
  drawGrid();
}

function loadState() {
  let g = localStorage.getItem('bingoGrid');
  let s = localStorage.getItem('bingoStrikes');
  let st = localStorage.getItem('bingoStarted');
  if (g && s && st==='yes') {
    grid = JSON.parse(g);
    strikes = JSON.parse(s);
    started = true;
    document.getElementById('setup-panel').style.display='none';
    document.getElementById('container').style.display='';
    document.getElementById('reset-btn').style.display='';
    document.getElementById('debug-btn').style.display='';
    drawGrid();
    return true;
  }
  return false;
}

function saveState() {
  localStorage.setItem('bingoGrid', JSON.stringify(grid));
  localStorage.setItem('bingoStrikes', JSON.stringify(strikes));
  localStorage.setItem('bingoStarted', started?'yes':'no');
}

function resetGame() {
  localStorage.clear();
  location.reload();
}

function drawGrid() {
  let html='<table>';
  for(let i=0;i<ROWS;i++) {
    html += '<tr>';
    for(let j=0;j<COLS;j++) {
      let num = grid[i][j];
      let cls = strikes[i][j] ? 'striked' : '';
      html += `<td class="${cls}" onclick="toggleStrike(${i},${j})">${num}</td>`;
    }
    html+='</tr>';
  }
  html+='</table>';
  document.getElementById('container').innerHTML = html;
  drawBingoLetters();
  updateDebugInfo();
}

function toggleStrike(i,j){
  strikes[i][j]=!strikes[i][j];
  saveState();
  drawGrid();
  checkWin();
}

// COMPLETELY REWRITTEN STRIKE PROGRESS FUNCTION - NO BUGS
function countCompletedLines() {
  let completedLines = 0;
  
  // Check each row individually
  for(let rowIndex = 0; rowIndex < ROWS; rowIndex++) {
    let rowComplete = true;
    for(let colIndex = 0; colIndex < COLS; colIndex++) {
      if(strikes[rowIndex][colIndex] !== true) {
        rowComplete = false;
        break;
      }
    }
    if(rowComplete) {
      completedLines++;
    }
  }
  
  // Check each column individually  
  for(let colIndex = 0; colIndex < COLS; colIndex++) {
    let columnComplete = true;
    for(let rowIndex = 0; rowIndex < ROWS; rowIndex++) {
      if(strikes[rowIndex][colIndex] !== true) {
        columnComplete = false;
        break;
      }
    }
    if(columnComplete) {
      completedLines++;
    }
  }
  
  // Return max 5 (for B-I-N-G-O)
  return Math.min(completedLines, 5);
}

function drawBingoLetters() {
  const completedLines = countCompletedLines();
  let html='';
  for (let i = 0; i < 5; i++) {
    const isStruck = i < completedLines;
    html += `<span class="${isStruck ? 'striked' : ''}">${BINGO[i]}</span>`;
  }
  document.getElementById('bingo-letters').innerHTML = html;
}

function toggleDebug() {
  debugMode = !debugMode;
  document.getElementById('debug-info').style.display = debugMode ? 'block' : 'none';
  updateDebugInfo();
}

function updateDebugInfo() {
  if (!debugMode) return;
  
  const completedLines = countCompletedLines();
  let debugText = `Completed Lines: ${completedLines}\n\n`;
  
  // Show row completion status
  debugText += "Rows:\n";
  for(let i = 0; i < ROWS; i++) {
    const rowComplete = strikes[i].every(cell => cell === true);
    const strikeCount = strikes[i].filter(cell => cell === true).length;
    debugText += `Row ${i}: ${strikeCount}/5 ${rowComplete ? '‚úì COMPLETE' : ''}\n`;
  }
  
  // Show column completion status
  debugText += "\nColumns:\n";
  for(let j = 0; j < COLS; j++) {
    let colStrikeCount = 0;
    let colComplete = true;
    for(let i = 0; i < ROWS; i++) {
      if(strikes[i][j]) colStrikeCount++;
      if(!strikes[i][j]) colComplete = false;
    }
    debugText += `Col ${j}: ${colStrikeCount}/5 ${colComplete ? '‚úì COMPLETE' : ''}\n`;
  }
  
  document.getElementById('debug-info').innerText = debugText;
}

// Enhanced winning animations
function createConfetti() {
  const container = document.getElementById('confetti-container');
  container.style.display = 'block';
  container.innerHTML = '';
  
  const colors = ['#f093fb', '#667eea', '#764ba2', '#fff', '#f0f', '#0ff'];
  
  for (let i = 0; i < 200; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * 100 + 'vw';
    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.animationDelay = Math.random() * 2 + 's';
    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
    container.appendChild(confetti);
  }
  
  setTimeout(() => {
    container.style.display = 'none';
    container.innerHTML = '';
  }, 5000);
}

function createFireworks() {
  const container = document.getElementById('fireworks-container');
  container.style.display = 'block';
  container.innerHTML = '';
  
  const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dda0dd'];
  
  for (let burst = 0; burst < 8; burst++) {
    setTimeout(() => {
      const centerX = Math.random() * window.innerWidth;
      const centerY = Math.random() * window.innerHeight * 0.6;
      
      for (let i = 0; i < 30; i++) {
        const firework = document.createElement('div');
        firework.className = 'firework';
        firework.style.left = centerX + 'px';
        firework.style.top = centerY + 'px';
        firework.style.background = colors[Math.floor(Math.random() * colors.length)];
        
        const angle = (i * 12) * Math.PI / 180;
        const distance = Math.random() * 200 + 100;
        const dx = Math.cos(angle) * distance;
        const dy = Math.sin(angle) * distance;
        
        firework.style.setProperty('--dx', dx + 'px');
        firework.style.setProperty('--dy', dy + 'px');
        
        container.appendChild(firework);
        
        setTimeout(() => firework.remove(), 1500);
      }
    }, burst * 300);
  }
  
  setTimeout(() => {
    container.style.display = 'none';
  }, 4000);
}

function checkWin() {
  if (countCompletedLines() === 5) {
    setTimeout(() => {
      createConfetti();
      createFireworks();
      setTimeout(() => {
        alert("üéâ BINGO! Congratulations, you won! üèÜ");
      }, 1000);
    }, 500);
  }
}

// Initialize
createStarfield();
if(!loadState()) showSetupPanel();
</script>
</body>
</html>
